#!/bin/bash

# ==========================================
# JavaScript Secret Finder
# Downloads JS files from given URLs
# Scans for exposed secrets / API keys
# ==========================================

URL_LIST="urls.txt"
OUTPUT_DIR="js_downloads"
RESULTS="secret_findings.txt"

mkdir -p $OUTPUT_DIR
echo "JavaScript Secret Scan Started" > $RESULTS
echo "--------------------------------" >> $RESULTS

while read url; do
    echo "[+] Processing $url"
    
    # Extract JS file URLs from page
    JS_LINKS=$(curl -s $url | grep -oP '(?<=src=")[^"]+\.js' | sort -u)

    for js in $JS_LINKS; do
        
        # Handle relative paths
        if [[ $js != http* ]]; then
            FULL_JS_URL="$url/$js"
        else
            FULL_JS_URL="$js"
        fi

        FILENAME=$(echo $FULL_JS_URL | sed 's/[^a-zA-Z0-9]/_/g')
        curl -s -o "$OUTPUT_DIR/$FILENAME.js" "$FULL_JS_URL"

        echo "[+] Scanning $FULL_JS_URL" >> $RESULTS

        # Search for common secret patterns
        grep -E -i "(api[_-]?key|secret|token|password|access[_-]?key|aws_access_key_id|aws_secret_access_key|bearer\s+[A-Za-z0-9\._-]+)" \
        "$OUTPUT_DIR/$FILENAME.js" >> $RESULTS

    done

done < $URL_LIST

echo "Scan Completed. Results saved in $RESULTS"
